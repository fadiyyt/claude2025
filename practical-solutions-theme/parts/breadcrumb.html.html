<!-- wp:group {"style":{"spacing":{"padding":{"top":"var:preset|spacing|medium","bottom":"var:preset|spacing|medium"}}},"backgroundColor":"base","className":"breadcrumb-navigation","layout":{"type":"constrained"}} -->
<div class="wp-block-group breadcrumb-navigation has-base-background-color has-background" style="padding-top:var(--wp--preset--spacing--medium);padding-bottom:var(--wp--preset--spacing--medium)">
    
    <!-- wp:group {"layout":{"type":"flex","flexWrap":"wrap","verticalAlignment":"center","justifyContent":"space-between"}} -->
    <div class="wp-block-group">
        
        <!-- مسار التنقل -->
        <!-- wp:group {"style":{"spacing":{"blockGap":"var:preset|spacing|x-small"}},"className":"breadcrumb-trail","layout":{"type":"flex","flexWrap":"wrap","verticalAlignment":"center"}} -->
        <div class="wp-block-group breadcrumb-trail">
            
            <!-- أيقونة الرئيسية -->
            <!-- wp:html -->
            <nav aria-label="مسار التنقل" class="breadcrumb-nav">
                <ol class="breadcrumb-list" style="display: flex; align-items: center; gap: 0.5rem; margin: 0; padding: 0; list-style: none; font-size: 0.9rem;">
                    
                    <!-- الرئيسية -->
                    <li class="breadcrumb-item home">
                        <a href="/" class="breadcrumb-link home-link" style="color: var(--wp--preset--color--primary); text-decoration: none; display: flex; align-items: center; gap: 0.25rem; transition: color 0.3s ease;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            <span>الرئيسية</span>
                        </a>
                    </li>
                    
                    <!-- فاصل -->
                    <li class="breadcrumb-separator" style="color: var(--wp--preset--color--contrast); font-weight: 300;">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </li>
                    
                    <!-- مستوى ديناميكي - سيتم ملؤه بـ JavaScript -->
                    <li class="breadcrumb-item dynamic-level" style="display: none;">
                        <a href="#" class="breadcrumb-link" style="color: var(--wp--preset--color--contrast); text-decoration: none; transition: color 0.3s ease;">
                            <span class="breadcrumb-text"></span>
                        </a>
                    </li>
                    
                    <!-- فاصل ديناميكي -->
                    <li class="breadcrumb-separator dynamic-separator" style="display: none; color: var(--wp--preset--color--contrast); font-weight: 300;">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </li>
                    
                    <!-- الصفحة الحالية -->
                    <li class="breadcrumb-item current" style="color: var(--wp--preset--color--foreground); font-weight: 600;">
                        <span class="current-page-title" aria-current="page">
                            <!-- سيتم ملؤه ديناميكياً -->
                        </span>
                    </li>
                    
                </ol>
            </nav>
            <!-- /wp:html -->
            
        </div>
        <!-- /wp:group -->
        
        <!-- معلومات إضافية (وقت القراءة، التاريخ، إلخ) -->
        <!-- wp:group {"style":{"spacing":{"blockGap":"var:preset|spacing|small"}},"className":"breadcrumb-meta","layout":{"type":"flex","flexWrap":"wrap","verticalAlignment":"center"}} -->
        <div class="wp-block-group breadcrumb-meta">
            
            <!-- وقت القراءة المتوقع (للمقالات) -->
            <!-- wp:html -->
            <div class="reading-time-estimate" style="display: none; font-size: 0.85rem; color: var(--wp--preset--color--contrast); display: flex; align-items: center; gap: 0.25rem;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span class="reading-time-text">5 دقائق قراءة</span>
            </div>
            <!-- /wp:html -->
            
            <!-- تاريخ آخر تحديث (للصفحات) -->
            <!-- wp:html -->
            <div class="last-updated" style="display: none; font-size: 0.85rem; color: var(--wp--preset--color--contrast); display: flex; align-items: center; gap: 0.25rem;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 10C21 16.5 12 23 12 23S3 16.5 3 10C3 5.5 7.5 1 12 1C16.5 1 21 5.5 21 10Z"/>
                    <circle cx="12" cy="10" r="3"/>
                </svg>
                <span class="update-date-text">آخر تحديث: <time class="update-date"></time></span>
            </div>
            <!-- /wp:html -->
            
            <!-- مستوى الصعوبة (للحلول والنصائح) -->
            <!-- wp:html -->
            <div class="difficulty-level" style="display: none; font-size: 0.85rem; display: flex; align-items: center; gap: 0.25rem;">
                <span class="difficulty-icon">📊</span>
                <span class="difficulty-text" style="color: var(--wp--preset--color--contrast);">المستوى: </span>
                <span class="difficulty-value" style="font-weight: 600;"></span>
            </div>
            <!-- /wp:html -->
            
        </div>
        <!-- /wp:group -->
        
    </div>
    <!-- /wp:group -->
    
    <!-- شريط التقدم للقراءة (للمقالات الطويلة) -->
    <!-- wp:html -->
    <div class="reading-progress-container" style="display: none; width: 100%; height: 3px; background: var(--wp--preset--color--base); border-radius: 2px; margin-top: 1rem; overflow: hidden;">
        <div class="reading-progress-bar" style="height: 100%; background: linear-gradient(90deg, var(--wp--preset--color--primary), var(--wp--preset--color--accent)); width: 0%; transition: width 0.3s ease; border-radius: 2px;"></div>
    </div>
    <!-- /wp:html -->
    
</div>
<!-- /wp:group -->

<!-- سكريبت لإدارة مسار التنقل ديناميكياً -->
<!-- wp:html -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // إدارة مسار التنقل الديناميكي
    const breadcrumbNav = document.querySelector('.breadcrumb-nav');
    const currentPageTitle = document.querySelector('.current-page-title');
    const dynamicLevel = document.querySelector('.dynamic-level');
    const dynamicSeparator = document.querySelector('.dynamic-separator');
    const readingTimeEstimate = document.querySelector('.reading-time-estimate');
    const lastUpdated = document.querySelector('.last-updated');
    const difficultyLevel = document.querySelector('.difficulty-level');
    const readingProgressContainer = document.querySelector('.reading-progress-container');
    const readingProgressBar = document.querySelector('.reading-progress-bar');
    
    // تحديد نوع الصفحة الحالية
    const pageType = getPageType();
    const pageInfo = getPageInfo(pageType);
    
    // تحديث عنوان الصفحة الحالية
    if (currentPageTitle && pageInfo.title) {
        currentPageTitle.textContent = pageInfo.title;
    }
    
    // إضافة مستوى ديناميكي إذا لزم الأمر
    if (pageInfo.parentLevel) {
        addDynamicLevel(pageInfo.parentLevel);
    }
    
    // إظهار معلومات إضافية حسب نوع الصفحة
    showRelevantMeta(pageType, pageInfo);
    
    // إعداد شريط تقدم القراءة للمقالات
    if (pageType === 'single' && document.querySelector('.post-content')) {
        setupReadingProgress();
    }
    
    // إضافة schema markup للتنقل
    addBreadcrumbSchema();
    
    function getPageType() {
        const body = document.body;
        
        if (body.classList.contains('home')) return 'home';
        if (body.classList.contains('single')) return 'single';
        if (body.classList.contains('archive')) return 'archive';
        if (body.classList.contains('search')) return 'search';
        if (body.classList.contains('error404')) return '404';
        if (body.classList.contains('page')) return 'page';
        
        return 'default';
    }
    
    function getPageInfo(pageType) {
        const info = {
            title: '',
            parentLevel: null
        };
        
        switch (pageType) {
            case 'single':
                const postTitle = document.querySelector('h1.entry-title, h1.post-title, .wp-block-post-title');
                info.title = postTitle ? postTitle.textContent.trim() : 'المقال';
                
                // إضافة التصنيف كمستوى والد
                const category = document.querySelector('.post-categories a, .wp-block-post-terms a');
                if (category) {
                    info.parentLevel = {
                        title: category.textContent.trim(),
                        url: category.href
                    };
                }
                break;
                
            case 'archive':
                const archiveTitle = document.querySelector('.archive-title, .wp-block-query-title');
                info.title = archiveTitle ? archiveTitle.textContent.trim() : 'الأرشيف';
                break;
                
            case 'search':
                const searchQuery = new URLSearchParams(window.location.search).get('s');
                info.title = searchQuery ? `نتائج البحث عن: "${searchQuery}"` : 'نتائج البحث';
                break;
                
            case '404':
                info.title = 'صفحة غير موجودة';
                break;
                
            case 'page':
                const pageTitle = document.querySelector('h1.entry-title, h1.page-title, .wp-block-post-title');
                info.title = pageTitle ? pageTitle.textContent.trim() : 'صفحة';
                break;
                
            default:
                info.title = document.title.split(' - ')[0] || 'صفحة';
        }
        
        return info;
    }
    
    function addDynamicLevel(parentLevel) {
        if (dynamicLevel && dynamicSeparator) {
            const link = dynamicLevel.querySelector('.breadcrumb-link');
            const text = dynamicLevel.querySelector('.breadcrumb-text');
            
            if (link && text) {
                link.href = parentLevel.url;
                text.textContent = parentLevel.title;
                
                dynamicLevel.style.display = 'block';
                dynamicSeparator.style.display = 'block';
            }
        }
    }
    
    function showRelevantMeta(pageType, pageInfo) {
        // إظهار وقت القراءة للمقالات
        if (pageType === 'single' && readingTimeEstimate) {
            const content = document.querySelector('.post-content, .wp-block-post-content, .entry-content');
            if (content) {
                const readingTime = calculateReadingTime(content);
                const timeText = readingTimeEstimate.querySelector('.reading-time-text');
                if (timeText) {
                    timeText.textContent = `${readingTime} دقائق قراءة`;
                    readingTimeEstimate.style.display = 'flex';
                }
            }
        }
        
        // إظهار تاريخ آخر تحديث
        if (lastUpdated) {
            const updateDate = getLastModifiedDate();
            if (updateDate) {
                const dateElement = lastUpdated.querySelector('.update-date');
                if (dateElement) {
                    dateElement.textContent = updateDate;
                    dateElement.setAttribute('datetime', getISODate());
                    lastUpdated.style.display = 'flex';
                }
            }
        }
        
        // إظهار مستوى الصعوبة للحلول
        if ((pageType === 'single') && difficultyLevel) {
            const difficulty = getDifficultyLevel();
            if (difficulty) {
                const difficultyValue = difficultyLevel.querySelector('.difficulty-value');
                if (difficultyValue) {
                    difficultyValue.textContent = difficulty.text;
                    difficultyValue.style.color = difficulty.color;
                    difficultyLevel.style.display = 'flex';
                }
            }
        }
    }
    
    function calculateReadingTime(content) {
        const wordsPerMinute = 200; // متوسط القراءة بالعربية
        const text = content.textContent || content.innerText || '';
        const wordCount = text.trim().split(/\s+/).length;
        const readingTime = Math.ceil(wordCount / wordsPerMinute);
        return Math.max(1, readingTime); // على الأقل دقيقة واحدة
    }
    
    function getLastModifiedDate() {
        // محاولة الحصول على تاريخ آخر تعديل من meta tag أو other source
        const modifiedMeta = document.querySelector('meta[property="article:modified_time"]');
        if (modifiedMeta) {
            const date = new Date(modifiedMeta.content);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        return null;
    }
    
    function getISODate() {
        const modifiedMeta = document.querySelector('meta[property="article:modified_time"]');
        return modifiedMeta ? modifiedMeta.content : new Date().toISOString();
    }
    
    function getDifficultyLevel() {
        // البحث عن مستوى الصعوبة في meta data أو content
        const difficultyMeta = document.querySelector('meta[name="difficulty"]');
        if (difficultyMeta) {
            const level = difficultyMeta.content.toLowerCase();
            const levels = {
                'easy': { text: 'سهل', color: '#27ae60' },
                'medium': { text: 'متوسط', color: '#f39c12' },
                'hard': { text: 'صعب', color: '#e74c3c' }
            };
            return levels[level] || null;
        }
        return null;
    }
    
    function setupReadingProgress() {
        if (!readingProgressContainer || !readingProgressBar) return;
        
        readingProgressContainer.style.display = 'block';
        
        function updateProgress() {
            const content = document.querySelector('.post-content, .wp-block-post-content, .entry-content');
            if (!content) return;
            
            const contentTop = content.offsetTop;
            const contentHeight = content.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            const startPoint = contentTop - windowHeight / 4;
            const endPoint = contentTop + contentHeight - windowHeight / 4;
            const totalDistance = endPoint - startPoint;
            
            if (scrollTop < startPoint) {
                readingProgressBar.style.width = '0%';
            } else if (scrollTop > endPoint) {
                readingProgressBar.style.width = '100%';
            } else {
                const progress = ((scrollTop - startPoint) / totalDistance) * 100;
                readingProgressBar.style.width = Math.min(100, Math.max(0, progress)) + '%';
            }
        }
        
        // تحديث التقدم عند التمرير
        let ticking = false;
        function onScroll() {
            if (!ticking) {
                requestAnimationFrame(function() {
                    updateProgress();
                    ticking = false;
                });
                ticking = true;
            }
        }
        
        window.addEventListener('scroll', onScroll);
        updateProgress(); // تحديث أولي
    }
    
    function addBreadcrumbSchema() {
        // إضافة بيانات منظمة لمسار التنقل
        const breadcrumbItems = document.querySelectorAll('.breadcrumb-item');
        const schemaData = {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": []
        };
        
        breadcrumbItems.forEach((item, index) => {
            const link = item.querySelector('a');
            const text = link ? link.textContent.trim() : item.textContent.trim();
            const url = link ? link.href : window.location.href;
            
            if (text && url) {
                schemaData.itemListElement.push({
                    "@type": "ListItem",
                    "position": index + 1,
                    "name": text,
                    "item": url
                });
            }
        });
        
        if (schemaData.itemListElement.length > 0) {
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(schemaData);
            document.head.appendChild(script);
        }
    }
    
    // إضافة hover effects للروابط
    const breadcrumbLinks = document.querySelectorAll('.breadcrumb-link');
    breadcrumbLinks.forEach(link => {
        link.addEventListener('mouseenter', function() {
            this.style.color = 'var(--wp--preset--color--primary)';
        });
        
        link.addEventListener('mouseleave', function() {
            if (!this.classList.contains('home-link')) {
                this.style.color = 'var(--wp--preset--color--contrast)';
            }
        });
    });
});
</script>
<!-- /wp:html -->

<!-- أنماط إضافية للاستجابة -->
<!-- wp:html -->
<style>
/* أنماط مسار التنقل الإضافية */
.breadcrumb-navigation {
    font-family: inherit;
    border-bottom: 1px solid var(--wp--preset--color--base, #ecf0f1);
}

.breadcrumb-link:hover {
    text-decoration: underline;
}

.breadcrumb-item.current {
    font-weight: 600;
}

/* تأثيرات التفاعل */
.breadcrumb-link,
.breadcrumb-meta > div {
    transition: all 0.3s ease;
}

.reading-progress-bar {
    position: relative;
    overflow: hidden;
}

.reading-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* الاستجابة للأجهزة المحمولة */
@media (max-width: 768px) {
    .breadcrumb-navigation .wp-block-group {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .breadcrumb-trail {
        width: 100%;
    }
    
    .breadcrumb-meta {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
        font-size: 0.8rem;
    }
    
    .breadcrumb-list {
        flex-wrap: wrap;
        gap: 0.25rem !important;
    }
    
    .breadcrumb-item {
        font-size: 0.85rem;
    }
    
    .current-page-title {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
}

@media (max-width: 480px) {
    .breadcrumb-meta > div {
        font-size: 0.75rem;
    }
    
    .reading-progress-container {
        margin-top: 0.5rem;
        height: 2px;
    }
}

/* تحسينات إضافية للوصول */
.breadcrumb-nav {
    font-size: 0.9rem;
}

.breadcrumb-link:focus {
    outline: 2px solid var(--wp--preset--color--primary);
    outline-offset: 2px;
    border-radius: 4px;
}

/* تأثيرات بصرية للمعلومات الإضافية */
.breadcrumb-meta > div:hover {
    transform: translateY(-1px);
    color: var(--wp--preset--color--primary) !important;
}

.difficulty-level .difficulty-value {
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid currentColor;
    font-size: 0.75rem;
}

.reading-time-estimate:hover,
.last-updated:hover,
.difficulty-level:hover {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.25rem 0.5rem;
    margin: -0.25rem -0.5rem;
}
</style>
<!-- /wp:html -->