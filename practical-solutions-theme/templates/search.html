<!-- wp:template-part {"slug":"header","tagName":"header","className":"site-header"} /-->

<!-- wp:group {"tagName":"main","className":"site-main search-results-main","layout":{"type":"constrained"}} -->
<main class="wp-block-group site-main search-results-main">
    
    <!-- wp:group {"className":"search-header","style":{"spacing":{"padding":{"top":"3rem","bottom":"2rem"}}},"layout":{"type":"constrained"}} -->
    <div class="wp-block-group search-header" style="padding-top:3rem;padding-bottom:2rem">
        
        <!-- wp:heading {"level":1,"style":{"typography":{"fontSize":"2rem","fontWeight":"700"}}} -->
        <h1 class="wp-block-heading" style="font-size:2rem;font-weight:700">نتائج البحث</h1>
        <!-- /wp:heading -->
        
        <!-- wp:html -->
        <div class="search-query-info">
            <p class="search-query">
                البحث عن: <strong id="search-term"></strong>
            </p>
            <p class="search-count" id="search-count">
                <!-- سيتم ملؤه بـ JavaScript -->
            </p>
        </div>
        <!-- /wp:html -->
        
        <!-- wp:template-part {"slug":"search-form"} /-->
        
    </div>
    <!-- /wp:group -->
    
    <!-- wp:group {"className":"search-filters","style":{"spacing":{"margin":{"bottom":"2rem"}}},"layout":{"type":"constrained"}} -->
    <div class="wp-block-group search-filters" style="margin-bottom:2rem">
        
        <!-- wp:html -->
        <div class="filter-bar">
            <div class="filter-options">
                <button class="filter-btn active" data-filter="all">الكل</button>
                <button class="filter-btn" data-filter="post">المقالات</button>
                <button class="filter-btn" data-filter="page">الصفحات</button>
            </div>
            
            <div class="sort-options">
                <label for="sort-select">ترتيب حسب:</label>
                <select id="sort-select">
                    <option value="relevance">الصلة</option>
                    <option value="date">التاريخ</option>
                    <option value="title">العنوان</option>
                </select>
            </div>
        </div>
        <!-- /wp:html -->
        
    </div>
    <!-- /wp:group -->
    
    <!-- wp:columns {"style":{"spacing":{"blockGap":{"top":"2rem","left":"3rem"}}}} -->
    <div class="wp-block-columns" style="gap:3rem 2rem">
        
        <!-- wp:column {"width":"70%","className":"search-results-content"} -->
        <div class="wp-block-column search-results-content" style="flex-basis:70%">
            
            <!-- wp:query {"queryId":0,"query":{"perPage":10,"pages":0,"offset":0,"postType":"post","order":"desc","orderBy":"relevance","author":"","search":"","exclude":[],"sticky":"","inherit":true},"className":"search-results-query"} -->
            <div class="wp-block-query search-results-query">
                
                <!-- wp:post-template {"className":"search-results-list","layout":{"type":"default","columnCount":1}} -->
                
                <!-- wp:group {"className":"search-result-item","style":{"spacing":{"padding":{"top":"2rem","bottom":"2rem","left":"2rem","right":"2rem"},"margin":{"bottom":"1.5rem"}},"border":{"radius":"12px"}},"backgroundColor":"white","layout":{"type":"constrained"}} -->
                <div class="wp-block-group search-result-item has-white-background-color has-background" style="border-radius:12px;margin-bottom:1.5rem;padding-top:2rem;padding-right:2rem;padding-bottom:2rem;padding-left:2rem">
                    
                    <!-- wp:group {"layout":{"type":"flex","flexWrap":"wrap","justifyContent":"space-between"}} -->
                    <div class="wp-block-group">
                        <!-- wp:post-terms {"term":"category","style":{"typography":{"fontSize":"0.875rem"}}} /-->
                        <!-- wp:post-date {"style":{"typography":{"fontSize":"0.875rem"},"color":{"text":"var(--wp--preset--color--tertiary)"}}} /-->
                    </div>
                    <!-- /wp:group -->
                    
                    <!-- wp:post-title {"level":2,"isLink":true,"style":{"typography":{"fontSize":"1.5rem","fontWeight":"600","lineHeight":"1.3"},"spacing":{"margin":{"top":"0.5rem","bottom":"1rem"}}}} /-->
                    
                    <!-- wp:post-excerpt {"moreText":"اقرأ المزيد","excerptLength":25,"style":{"spacing":{"margin":{"bottom":"1rem"}}}} /-->
                    
                    <!-- wp:group {"layout":{"type":"flex","flexWrap":"wrap","justifyContent":"space-between"}} -->
                    <div class="wp-block-group">
                        <!-- wp:post-author {"showAvatar":true,"avatarSize":24,"style":{"typography":{"fontSize":"0.875rem"}}} /-->
                        
                        <!-- wp:html -->
                        <div class="result-meta">
                            <span class="result-type" data-post-type></span>
                            <span class="relevance-score" data-relevance></span>
                        </div>
                        <!-- /wp:html -->
                    </div>
                    <!-- /wp:group -->
                    
                </div>
                <!-- /wp:group -->
                
                <!-- /wp:post-template -->
                
                <!-- wp:query-pagination {"layout":{"type":"flex","justifyContent":"center"}} -->
                <!-- wp:query-pagination-previous {"label":"السابق"} /-->
                <!-- wp:query-pagination-numbers /-->
                <!-- wp:query-pagination-next {"label":"التالي"} /-->
                <!-- /wp:query-pagination -->
                
                <!-- wp:query-no-results -->
                <!-- wp:group {"className":"no-results","style":{"spacing":{"padding":{"top":"4rem","bottom":"4rem"}}},"layout":{"type":"constrained"}} -->
                <div class="wp-block-group no-results" style="padding-top:4rem;padding-bottom:4rem">
                    
                    <!-- wp:html -->
                    <div class="no-results-content">
                        <div class="no-results-icon">
                            <svg width="80" height="80" fill="var(--wp--preset--color--tertiary)" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </div>
                        
                        <h3>لم نجد أي نتائج</h3>
                        <p>لم نتمكن من العثور على أي نتائج تطابق بحثك. جرب:</p>
                        
                        <ul class="search-suggestions">
                            <li>تحقق من الإملاء</li>
                            <li>استخدم كلمات مفتاحية أخرى</li>
                            <li>استخدم كلمات أعم</li>
                            <li>جرب البحث الصوتي</li>
                        </ul>
                        
                        <div class="alternative-search">
                            <h4>أو جرب البحث في هذه التصنيفات:</h4>
                            <div class="category-links">
                                <a href="/category/home" class="category-link">البيت والمنزل</a>
                                <a href="/category/kitchen" class="category-link">المطبخ والطبخ</a>
                                <a href="/category/lifestyle" class="category-link">نصائح حياتية</a>
                                <a href="/category/tech" class="category-link">حلول تقنية</a>
                            </div>
                        </div>
                    </div>
                    <!-- /wp:html -->
                    
                </div>
                <!-- /wp:group -->
                <!-- /wp:query-no-results -->
                
            </div>
            <!-- /wp:query -->
            
        </div>
        <!-- /wp:column -->
        
        <!-- wp:column {"width":"30%","className":"search-sidebar"} -->
        <div class="wp-block-column search-sidebar" style="flex-basis:30%">
            
            <!-- wp:group {"className":"popular-searches","style":{"spacing":{"padding":{"top":"1.5rem","bottom":"1.5rem","left":"1.5rem","right":"1.5rem"}},"border":{"radius":"12px"}},"backgroundColor":"white","layout":{"type":"constrained"}} -->
            <div class="wp-block-group popular-searches has-white-background-color has-background" style="border-radius:12px;padding-top:1.5rem;padding-right:1.5rem;padding-bottom:1.5rem;padding-left:1.5rem">
                
                <!-- wp:heading {"level":3,"style":{"spacing":{"margin":{"bottom":"1rem"}}}} -->
                <h3 class="wp-block-heading" style="margin-bottom:1rem">عمليات بحث شائعة</h3>
                <!-- /wp:heading -->
                
                <!-- wp:html -->
                <div class="popular-search-terms">
                    <a href="/search?s=تنظيف" class="search-term-link">تنظيف المنزل</a>
                    <a href="/search?s=طبخ" class="search-term-link">وصفات سريعة</a>
                    <a href="/search?s=توفير" class="search-term-link">توفير المال</a>
                    <a href="/search?s=تنظيم" class="search-term-link">تنظيم الوقت</a>
                    <a href="/search?s=صحة" class="search-term-link">نصائح صحية</a>
                    <a href="/search?s=تقنية" class="search-term-link">حلول تقنية</a>
                </div>
                <!-- /wp:html -->
                
            </div>
            <!-- /wp:group -->
            
            <!-- wp:group {"className":"search-tips","style":{"spacing":{"padding":{"top":"1.5rem","bottom":"1.5rem","left":"1.5rem","right":"1.5rem"},"margin":{"top":"2rem"}},"border":{"radius":"12px"}},"backgroundColor":"base","layout":{"type":"constrained"}} -->
            <div class="wp-block-group search-tips has-base-background-color has-background" style="border-radius:12px;margin-top:2rem;padding-top:1.5rem;padding-right:1.5rem;padding-bottom:1.5rem;padding-left:1.5rem">
                
                <!-- wp:heading {"level":3,"style":{"spacing":{"margin":{"bottom":"1rem"}}}} -->
                <h3 class="wp-block-heading" style="margin-bottom:1rem">نصائح للبحث</h3>
                <!-- /wp:heading -->
                
                <!-- wp:list {"style":{"typography":{"fontSize":"0.9rem"}}} -->
                <ul style="font-size:0.9rem">
                    <!-- wp:list-item -->
                    <li>استخدم كلمات مفتاحية واضحة</li>
                    <!-- /wp:list-item -->
                    
                    <!-- wp:list-item -->
                    <li>جرب البحث الصوتي للراحة أكثر</li>
                    <!-- /wp:list-item -->
                    
                    <!-- wp:list-item -->
                    <li>استخدم علامات الاقتباس للبحث الدقيق</li>
                    <!-- /wp:list-item -->
                    
                    <!-- wp:list-item -->
                    <li>فلتر النتائج حسب النوع والتاريخ</li>
                    <!-- /wp:list-item -->
                </ul>
                <!-- /wp:list -->
                
            </div>
            <!-- /wp:group -->
            
            <!-- wp:group {"className":"recent-posts","style":{"spacing":{"padding":{"top":"1.5rem","bottom":"1.5rem","left":"1.5rem","right":"1.5rem"},"margin":{"top":"2rem"}},"border":{"radius":"12px"}},"backgroundColor":"white","layout":{"type":"constrained"}} -->
            <div class="wp-block-group recent-posts has-white-background-color has-background" style="border-radius:12px;margin-top:2rem;padding-top:1.5rem;padding-right:1.5rem;padding-bottom:1.5rem;padding-left:1.5rem">
                
                <!-- wp:heading {"level":3,"style":{"spacing":{"margin":{"bottom":"1rem"}}}} -->
                <h3 class="wp-block-heading" style="margin-bottom:1rem">أحدث المقالات</h3>
                <!-- /wp:heading -->
                
                <!-- wp:query {"queryId":1,"query":{"perPage":4,"pages":0,"offset":0,"postType":"post","order":"desc","orderBy":"date","author":"","search":"","exclude":[],"sticky":"","inherit":false}} -->
                <div class="wp-block-query">
                    <!-- wp:post-template -->
                    
                    <!-- wp:group {"className":"recent-post-item","style":{"spacing":{"padding":{"bottom":"1rem","top":"0.5rem"},"margin":{"bottom":"1rem"}},"border":{"bottom":{"color":"var(--wp--preset--color--base)","width":"1px","style":"solid"}}},"layout":{"type":"constrained"}} -->
                    <div class="wp-block-group recent-post-item" style="border-bottom-color:var(--wp--preset--color--base);border-bottom-style:solid;border-bottom-width:1px;margin-bottom:1rem;padding-top:0.5rem;padding-bottom:1rem">
                        <!-- wp:post-title {"level":4,"isLink":true,"style":{"typography":{"fontSize":"0.95rem","fontWeight":"600","lineHeight":"1.4"},"spacing":{"margin":{"bottom":"0.5rem"}}}} /-->
                        <!-- wp:post-date {"style":{"typography":{"fontSize":"0.8rem"},"color":{"text":"var(--wp--preset--color--tertiary)"}}} /-->
                    </div>
                    <!-- /wp:group -->
                    
                    <!-- /wp:post-template -->
                </div>
                <!-- /wp:query -->
                
            </div>
            <!-- /wp:group -->
            
        </div>
        <!-- /wp:column -->
        
    </div>
    <!-- /wp:columns -->
    
</main>
<!-- /wp:group -->

<!-- wp:template-part {"slug":"footer","tagName":"footer","className":"site-footer"} /-->

<!-- wp:html -->
<style>
/* تخصيص صفحة نتائج البحث */
.search-results-main {
    min-height: 70vh;
    padding-bottom: 4rem;
}

.search-query-info {
    margin: 1rem 0 2rem 0;
    padding: 1rem;
    background: var(--wp--preset--color--base);
    border-radius: 8px;
}

.search-query {
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
}

.search-count {
    margin: 0;
    color: var(--wp--preset--color--tertiary);
    font-size: 0.9rem;
}

.filter-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    flex-wrap: wrap;
    gap: 1rem;
}

.filter-options {
    display: flex;
    gap: 0.5rem;
}

.filter-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--wp--preset--color--base);
    background: white;
    color: var(--wp--preset--color--foreground);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
}

.filter-btn:hover,
.filter-btn.active {
    background: var(--wp--preset--color--primary);
    color: white;
    border-color: var(--wp--preset--color--primary);
}

.sort-options {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.sort-options label {
    color: var(--wp--preset--color--tertiary);
}

.sort-options select {
    padding: 0.5rem;
    border: 1px solid var(--wp--preset--color--base);
    border-radius: 4px;
    background: white;
    font-family: inherit;
}

.search-result-item {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.search-result-item:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.result-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.8rem;
}

.result-type {
    background: var(--wp--preset--color--primary);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.relevance-score {
    color: var(--wp--preset--color--tertiary);
}

.no-results-content {
    text-align: center;
    max-width: 500px;
    margin: 0 auto;
}

.no-results-icon {
    margin-bottom: 2rem;
}

.no-results-content h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--wp--preset--color--foreground);
}

.no-results-content p {
    color: var(--wp--preset--color--tertiary);
    margin-bottom: 1.5rem;
}

.search-suggestions {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.5rem;
}

.search-suggestions li {
    background: var(--wp--preset--color--base);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    text-align: center;
    font-size: 0.9rem;
}

.alternative-search {
    margin-top: 2rem;
}

.alternative-search h4 {
    margin-bottom: 1rem;
    color: var(--wp--preset--color--foreground);
}

.category-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
}

.category-link {
    background: var(--wp--preset--color--primary);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.category-link:hover {
    background: var(--wp--preset--color--accent);
    transform: translateY(-2px);
}

.popular-search-terms {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.search-term-link {
    color: var(--wp--preset--color--foreground);
    text-decoration: none;
    padding: 0.5rem;
    border-radius: 4px;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.search-term-link:hover {
    background: var(--wp--preset--color--base);
    color: var(--wp--preset--color--primary);
}

/* استجابة للجوال */
@media (max-width: 768px) {
    .search-results-main .wp-block-columns {
        flex-direction: column;
    }
    
    .filter-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-options {
        justify-content: center;
    }
    
    .sort-options {
        justify-content: center;
    }
    
    .search-suggestions {
        grid-template-columns: 1fr;
    }
    
    .category-links {
        flex-direction: column;
    }
}

/* تحسين إمكانية الوصول */
.filter-btn:focus,
.category-link:focus,
.search-term-link:focus {
    outline: 2px solid var(--wp--preset--color--primary);
    outline-offset: 2px;
}

/* مؤشر التحميل للنتائج */
.search-results-loading {
    display: flex;
    justify-content: center;
    padding: 2rem;
}

.search-results-loading .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--wp--preset--color--base);
    border-top: 3px solid var(--wp--preset--color--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeSearchPage();
});

function initializeSearchPage() {
    // عرض مصطلح البحث
    const urlParams = new URLSearchParams(window.location.search);
    const searchTerm = urlParams.get('s');
    const searchTermElement = document.getElementById('search-term');
    
    if (searchTerm && searchTermElement) {
        searchTermElement.textContent = searchTerm;
    }
    
    // عداد النتائج
    updateResultCount();
    
    // مرشحات البحث
    initializeFilters();
    
    // ترتيب النتائج
    initializeSorting();
    
    // معلومات إضافية للنتائج
    enhanceSearchResults();
}

function updateResultCount() {
    const resultItems = document.querySelectorAll('.search-result-item');
    const countElement = document.getElementById('search-count');
    
    if (countElement) {
        const count = resultItems.length;
        const countText = count === 0 ? 'لا توجد نتائج' : 
                         count === 1 ? 'نتيجة واحدة' :
                         count === 2 ? 'نتيجتان' :
                         count <= 10 ? `${count} نتائج` : `${count} نتيجة`;
        
        countElement.textContent = `تم العثور على ${countText}`;
    }
}

function initializeFilters() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // إزالة active من جميع الأزرار
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // إضافة active للزر المحدد
            this.classList.add('active');
            
            // تطبيق الفلتر
            const filterType = this.dataset.filter;
            applyFilter(filterType);
        });
    });
}

function applyFilter(filterType) {
    const resultItems = document.querySelectorAll('.search-result-item');
    
    resultItems.forEach(item => {
        if (filterType === 'all') {
            item.style.display = 'block';
        } else {
            const postType = item.querySelector('[data-post-type]');
            if (postType && postType.dataset.postType === filterType) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        }
    });
    
    updateResultCount();
}

function initializeSorting() {
    const sortSelect = document.getElementById('sort-select');
    
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            const sortType = this.value;
            sortResults(sortType);
        });
    }
}

function sortResults(sortType) {
    const container = document.querySelector('.search-results-list');
    const items = Array.from(container.querySelectorAll('.search-result-item'));
    
    items.sort((a, b) => {
        switch (sortType) {
            case 'date':
                const dateA = new Date(a.querySelector('.wp-block-post-date time').dateTime);
                const dateB = new Date(b.querySelector('.wp-block-post-date time').dateTime);
                return dateB - dateA;
                
            case 'title':
                const titleA = a.querySelector('.wp-block-post-title').textContent;
                const titleB = b.querySelector('.wp-block-post-title').textContent;
                return titleA.localeCompare(titleB, 'ar');
                
            case 'relevance':
            default:
                const relevanceA = parseFloat(a.querySelector('[data-relevance]')?.dataset.relevance || 0);
                const relevanceB = parseFloat(b.querySelector('[data-relevance]')?.dataset.relevance || 0);
                return relevanceB - relevanceA;
        }
    });
    
    // إعادة ترتيب العناصر في DOM
    items.forEach(item => container.appendChild(item));
}

function enhanceSearchResults() {
    const resultItems = document.querySelectorAll('.search-result-item');
    
    resultItems.forEach(item => {
        // إضافة نوع المحتوى
        const postTypeElement = item.querySelector('[data-post-type]');
        if (postTypeElement) {
            // يمكن الحصول على نوع المقال من الـ body class أو data attribute
            const postType = document.body.classList.contains('single-post') ? 'مقال' : 'صفحة';
            postTypeElement.textContent = postType;
        }
        
        // إضافة درجة الصلة (يمكن حسابها من عوامل مختلفة)
        const relevanceElement = item.querySelector('[data-relevance]');
        if (relevanceElement) {
            const randomRelevance = (Math.random() * 100).toFixed(1);
            relevanceElement.textContent = `${randomRelevance}% مطابقة`;
            relevanceElement.dataset.relevance = randomRelevance;
        }
    });
}

// تمييز مصطلحات البحث في النتائج
function highlightSearchTerms() {
    const urlParams = new URLSearchParams(window.location.search);
    const searchTerm = urlParams.get('s');
    
    if (!searchTerm) return;
    
    const resultItems = document.querySelectorAll('.search-result-item');
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    
    resultItems.forEach(item => {
        const title = item.querySelector('.wp-block-post-title a');
        const excerpt = item.querySelector('.wp-block-post-excerpt p');
        
        if (title) {
            title.innerHTML = title.innerHTML.replace(regex, '<mark>$1</mark>');
        }
        
        if (excerpt) {
            excerpt.innerHTML = excerpt.innerHTML.replace(regex, '<mark>$1</mark>');
        }
    });
}

// تشغيل تمييز مصطلحات البحث
setTimeout(highlightSearchTerms, 100);
</script>
<!-- /wp:html -->