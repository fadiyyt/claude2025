"use strict";window.PracticalSolutionsApp=function(){let e=!1,t={},n={startTime:Date.now(),initTime:null,systems:{}};const i={debug:!1,enablePerformanceMonitoring:!0,initTimeout:1e4,systems:{utils:{enabled:!0,priority:1},search:{enabled:!0,priority:2,options:{minSearchLength:2,debounceDelay:300,enableAutoComplete:!0,enableHistory:!0,enableInstantSearch:!1}},voiceSearch:{enabled:!0,priority:3,options:{language:"ar-SA",timeout:1e4,autoSubmit:!1,showVisualFeedback:!0}},navigation:{enabled:!0,priority:2,options:{enableStickyHeader:!0,enableBackToTop:!0,enableSmoothScroll:!0,mobileBreakpoint:768}},lazyLoading:{enabled:!0,priority:2,options:{threshold:.5,rootMargin:"50px",enableWebP:!0,placeholderColor:"#f0f4f8"}},performance:{enabled:!0,priority:1,options:{enableCaching:!0,optimizeImages:!0,lazyLoadScripts:!0}}}};let s={};function a(){if(e)return console.warn("التطبيق مهيأ مسبقاً"),!0;console.log("🚀 بدء تهيئة تطبيق الحلول العملية...");const a=Date.now();s=Object.assign({},i,window.practicalSolutions||{});try{o(),r(),l(),e=!0,n.initTime=Date.now()-a,console.log(`✅ تم تهيئة التطبيق بنجاح في ${n.initTime}ms`),function(){const e=Object.keys(t).filter(e=>t[e].initialized).length,i=Object.keys(t).length;console.log(`📊 أنظمة مفعلة: ${e}/${i}`),n.systems.initialized=e,n.systems.total=i}()}catch(e){console.error("❌ خطأ في تهيئة التطبيق:",e)}return e}function o(){document.addEventListener("DOMContentLoaded",()=>{a(),setTimeout(()=>{c()},100)}),window.addEventListener("load",()=>{d(),s.enablePerformanceMonitoring&&u()})}function r(){const e=Object.keys(s.systems).sort((e,t)=>s.systems[e].priority-s.systems[t].priority);for(const i of e){if(!s.systems[i].enabled)continue;try{f(i)}catch(e){console.error(`خطأ في تهيئة نظام ${i}:`,e)}}}function l(){"online"===navigator.onLine&&(h(),g()),window.addEventListener("online",h),window.addEventListener("offline",g)}function c(){const e=document.querySelector(".search-form, .advanced-search-form");e&&(console.log("🔍 تفعيل نظام البحث المدمج"),e.addEventListener("submit",e=>{const t=e.target.querySelector('input[name="s"]');t&&""===t.value.trim()&&(e.preventDefault(),t.focus())}))}function d(){const e=document.querySelectorAll('img[data-src], iframe[data-src], [data-bg]');e.length>0&&!t.lazyLoading?.initialized&&window.LazyLoading&&(console.log("📷 تفعيل التحميل الكسول للصور"),window.LazyLoading.init());const n=document.querySelector(".back-to-top, #back-to-top");n&&!t.navigation?.initialized&&(console.log("⬆️ تفعيل زر العودة لأعلى"),n.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function u(){console.log("📈 تفعيل مراقبة الأداء");const e={navigation:performance.getEntriesByType("navigation")[0],resources:performance.getEntriesByType("resource").length,memory:performance.memory||null};console.log("أداء الصفحة:",e),e.navigation&&console.log(`⏱️ وقت التحميل: ${Math.round(e.navigation.loadEventEnd-e.navigation.fetchStart)}ms`)}function f(e){const n=s.systems[e];if(!n||!n.enabled)return!1;let a=null,o=!1;switch(e){case"utils":window.PracticalSolutionsUtils&&(a=window.PracticalSolutionsUtils,o=!0);break;case"search":window.PracticalSolutionsSearch&&(a=window.PracticalSolutionsSearch.init(n.options),o=!!a);break;case"voiceSearch":window.VoiceSearch&&(a=window.VoiceSearch.init(n.options),o=!!a);break;case"navigation":window.PracticalSolutionsNavigation&&(a=window.PracticalSolutionsNavigation.init(n.options),o=!!a);break;case"lazyLoading":window.LazyLoading&&(a=window.LazyLoading.init(n.options),o=!!a);break;default:console.warn(`نظام غير معروف: ${e}`)}return t[e]={instance:a,initialized:o,priority:n.priority,options:n.options},o?(console.log(`✅ تم تهيئة نظام ${e} بنجاح`),!0):(console.warn(`⚠️ فشل في تهيئة نظام ${e}`),!1)}function h(){console.log("🌐 تم استعادة الاتصال بالإنترنت"),t.search&&!t.search.initialized&&function(e){try{f(e)&&console.log(`♻️ تم إعادة تهيئة نظام ${e}`)}catch(t){console.error(`خطأ في إعادة تهيئة نظام ${e}:`,t)}}("search"),t.lazyLoading&&t.lazyLoading.instance&&t.lazyLoading.instance.refresh()}function g(){console.log("🚫 تم قطع الاتصال بالإنترنت"),function(){Object.keys(t).forEach(e=>{const n=t[e];n.instance&&"function"==typeof n.instance.pause&&n.instance.pause()})}(),window.PracticalSolutionsUtils&&window.PracticalSolutionsUtils.showNotification("تم قطع الاتصال بالإنترنت. بعض الميزات قد لا تعمل.","warning")}return{init:a,getSystem:e=>t[e]||null,isInitialized:()=>e,getPerformance:()=>n,scrollToTop:()=>{window.scrollTo({top:0,behavior:"smooth"})},toggleMobileMenu:function(){t.navigation&&t.navigation.instance&&t.navigation.instance.toggleMobileMenu()},handleReconnection:h,handleDisconnection:g,destroy:function(){Object.keys(t).forEach(e=>{const n=t[e];n.instance&&"function"==typeof n.instance.destroy&&n.instance.destroy()}),t={},e=!1,console.log("تم تدمير التطبيق")}}}(),function(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.PracticalSolutionsApp.init()}):window.PracticalSolutionsApp.init()}();